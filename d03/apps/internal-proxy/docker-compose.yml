# Internal reverse proxy for d03 (split-DNS / Pi-hole)
# When app hostnames resolve to d03 (e.g. via Pi-hole), this serves HTTPS and proxies to apps.
# TLS: Let's Encrypt via Cloudflare DNS-01 (set CF_API_TOKEN in .env).
#
# Start after any app that needs internal proxy is running (app network must exist).
# Ports 80 and 443 must not be used by another service on d03.

services:
  caddy-internal:
    image: caddybuilds/caddy-cloudflare:latest
    container_name: caddy-internal-d03
    restart: unless-stopped
    environment:
      - CF_API_TOKEN=${CF_API_TOKEN}
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
    networks:
      - tc_datalogger_net

networks:
  tc_datalogger_net:
    external: true
    name: tc_datalogger_net
