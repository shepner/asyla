# Docker Compose configuration for d03
# This is a template structure - containers will be added as needed
#
# This configuration addresses:
# - Network segmentation for security (internet-facing vs internal)
# - Coordinated start/stop with dependencies
# - Better backup coordination
# - Resource efficiency
# - Security hardening
#
# Environment variables are loaded from ~/scripts/docker/common.env
# Additional variables can be set in .env file (not in repository)

version: '3.8'

# Networks for security segmentation
networks:
  # Internet-facing network - for services exposed to internet (swag, etc.)
  internet:
    driver: bridge
    name: d03_internet
  
  # Internal network - for internal-only services
  internal:
    driver: bridge
    name: d03_internal
  
  # Backend network - for database/backend services
  backend:
    driver: bridge
    name: d03_backend

# Volumes (if needed - most use bind mounts to iSCSI)
volumes:
  # Example volume (if needed):
  # app_data:
  #   driver: local

services:
  # Template service - copy and modify as needed
  # example-service:
  #   image: lscr.io/linuxserver/example:latest
  #   container_name: example
  #   restart: unless-stopped
  #   networks:
  #     - internal  # or internet, backend as appropriate
  #   environment:
  #     - PUID=${DOCKER_UID:-1003}
  #     - PGID=${DOCKER_GID:-1000}
  #     - TZ=${LOCAL_TZ:-America/Chicago}
  #   volumes:
  #     - ${DOCKER_DL}/example:/config  # iSCSI storage for container data
  #   # Security hardening
  #   user: "${DOCKER_UID:-1003}:${DOCKER_GID:-1000}"
  #   read_only: false  # Set to true if service supports it
  #   security_opt:
  #     - no-new-privileges:true
  #   # Resource limits
  #   deploy:
  #     resources:
  #       limits:
  #         cpus: '2'
  #         memory: 2G
  #       reservations:
  #         cpus: '0.5'
  #         memory: 512M
  #   # Healthcheck (if available)
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3
  #     start_period: 40s

  # Backup service template (rsync-based backup coordination)
  # This will be implemented when containers are defined
  # backup-coordinator:
  #   image: alpine:latest
  #   container_name: backup-coordinator
  #   profiles:
  #     - backup
  #   networks:
  #     - internal
  #   volumes:
  #     - ${DOCKER_DL}:/source:ro  # iSCSI source (read-only)
  #     - ${DOCKER_D1}/backups:/backup/data1:rw  # NFS backup destination
  #     - ${DOCKER_D2}/backups:/backup/data2:rw  # NFS backup destination
  #   command: |
  #     sh -c "
  #     echo 'Backup coordination will be implemented here'
  #     # rsync-based backup logic
  #     # Parallel backups
  #     # Incremental strategy
  #     "

# Compose profiles for grouping containers
# Usage: docker compose --profile media up -d
# Profiles:
#   - media: Media-related containers
#   - monitoring: Monitoring and logging
#   - backup: Backup services
#   - core: Core infrastructure services

