# Internal reverse proxy for d01 (split-DNS / Pi-hole)
# When app hostnames resolve to d01 (e.g. via Pi-hole), this serves HTTPS and proxies to apps.
# TLS: Let's Encrypt via Cloudflare DNS-01 (set CF_API_TOKEN in .env).
#
# Start after any app that needs internal proxy is running (app network must exist).
# Ports 80 and 443 must not be used by another service on d01.

services:
  caddy-internal:
    image: caddybuilds/caddy-cloudflare:latest
    container_name: caddy-internal-d01
    restart: unless-stopped
    env_file: .env
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
    networks:
      - d01_internal
      - media_net
      - calibre_net
      - homebridge_net
      - duplicati_net

networks:
  d01_internal:
    external: true
    name: d01_internal
  media_net:
    external: true
    name: media_net
  calibre_net:
    external: true
    name: calibre_net
  homebridge_net:
    external: true
    name: homebridge_net
  duplicati_net:
    external: true
    name: duplicati_net
