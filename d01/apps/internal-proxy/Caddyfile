# Internal reverse proxy for d01
# When Pi-hole (or split DNS) points hostnames to d01 (10.0.0.60), these blocks serve HTTPS and proxy to the apps.
# TLS: Let's Encrypt via Cloudflare DNS-01 (CF_API_TOKEN in .env). Browsers trust certs automatically.

(internal_tls) {
    tls {
        dns cloudflare {env.CF_API_TOKEN}
        resolvers 1.1.1.1
    }
}

sonarr.asyla.org {
    import internal_tls
    reverse_proxy sonarr:8989
}
radarr.asyla.org {
    import internal_tls
    reverse_proxy radarr:7878
}
overseerr.asyla.org {
    import internal_tls
    reverse_proxy overseerr:5055
}
jackett.asyla.org {
    import internal_tls
    reverse_proxy jackett:9117
}
transmission.asyla.org {
    import internal_tls
    reverse_proxy transmission:9091
}
calibre.asyla.org {
    import internal_tls
    reverse_proxy calibre:8080
}
homebridge.asyla.org {
    import internal_tls
    reverse_proxy homebridge-proxy:8581
}
cameraui.asyla.org {
    import internal_tls
    reverse_proxy cameraui-proxy:8181
}
duplicati.asyla.org {
    import internal_tls
    reverse_proxy duplicati:8200
}

# Fallback for other hostnames / direct IP
:80 {
    respond "d01 internal proxy ready" 200
}
:443 {
    tls internal
    respond "d01 internal proxy ready" 200
}
